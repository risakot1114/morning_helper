        <div class="container mx-auto max-w-sm p-3 pb-24">

  <!-- ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== -->
  <header class="flex justify-between items-center py-4 px-2">
    <h1 class="app-title text-pink-300">ãŠå¤©æ°—Coordinateâ˜€ï¸</h1>
    <div class="w-8 h-8 flex items-center justify-center rounded-full bg-white shadow-md">
      <span class="text-xl" role="img" aria-label="settings">âš™ï¸</span>
    </div>
  </header>

  <main>
    <!-- ===== ä»Šæ—¥ã®å¤©æ°—ã‚¨ãƒªã‚¢ ===== -->
    <section class="card transform -rotate-1">
      <div class="mb-4">
        <div class="flex justify-between items-center mb-2">
          <p class="text-sm text-gray-500" id="date">2024å¹´10æœˆ22æ—¥ ç«æ›œæ—¥</p>
          <button id="weekly-weather-btn" class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-xs font-medium hover:bg-blue-200 transition-colors">
            é€±é–“äºˆå ±
          </button>
        </div>
        <p class="text-sm text-gray-500 text-center" id="location">æ±äº¬éƒ½, æ¸‹è°·åŒº</p>
      </div>
      
              <!-- æ¸©åº¦ã¨å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¸¦ã¹ã¦è¡¨ç¤º -->
              <div class="flex items-center justify-center gap-4 mb-4">
                <div class="text-6xl font-bold text-gray-700" id="temperature">16<span class="text-2xl align-top text-gray-500">â„ƒ</span></div>
                <span class="text-7xl animate-bounce" role="img" aria-label="weather" id="weather-icon">â˜ï¸</span>
              </div>
      
      <div class="text-center mb-3">
        <p class="text-xl font-semibold text-gray-700 mb-1">æ›‡ã‚Š</p>
        <p class="text-base text-gray-600" id="temp-range">19â„ƒ / 12â„ƒ</p>
      </div>
      
      <div class="flex justify-around text-center">
        <div>
          <p class="text-xs text-gray-500">é™æ°´ç¢ºç‡</p>
          <p class="text-lg font-bold text-gray-700" id="rain-probability">20%</p>
        </div>
        <div>
          <p class="text-xs text-gray-500">æ¹¿åº¦</p>
          <p class="text-lg font-bold text-gray-700" id="humidity">78%</p>
        </div>
        <div>
          <p class="text-xs text-gray-500">é¢¨é€Ÿ</p>
          <p class="text-lg font-bold text-gray-700" id="wind-speed">4.5m/s</p>
        </div>
      </div>
    </section>

    <!-- ===== ä»Šæ—¥ã®æœè£…ææ¡ˆã‚¨ãƒªã‚¢ ===== -->
    <section class="card transform rotate-1">
      <div class="flex justify-between items-center mb-3">
        <h3 class="font-bold text-xl">ãã‚‡ã†ã®ã‚³ãƒ¼ãƒ‡æ¡ˆ</h3>
        <button id="weekly-clothing-btn" class="px-3 py-1 bg-pink-100 text-pink-600 rounded-full text-xs font-medium hover:bg-pink-200 transition-colors">
          é€±é–“ã‚³ãƒ¼ãƒ‡
        </button>
      </div>
      
      <!-- ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ -->
      <div class="flex justify-center gap-1 mb-3">
        <button class="style-btn active" data-style="business" id="style-business">
          <span class="text-xl">ğŸ‘”</span>
          <span class="text-xs">ãƒ“ã‚¸ãƒã‚¹</span>
        </button>
        <button class="style-btn" data-style="casual" id="style-casual">
          <span class="text-xl">ğŸ‘•</span>
          <span class="text-xs">ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«</span>
        </button>
        <button class="style-btn" data-style="child" id="style-child">
          <span class="text-xl">ğŸ‘¶</span>
          <span class="text-xs">ã‚­ãƒƒã‚º</span>
        </button>
      </div>
      
      <div class="flex justify-around items-center text-center">
        <!-- æœè£…ã‚¢ã‚¤ã‚³ãƒ³ (çµµæ–‡å­—) -->
        <div class="flex flex-col items-center">
          <div class="icon-bg"><span role="img" aria-label="cardigan" id="clothing-icon-1">ğŸ§¥</span></div>
          <p class="text-xs mt-1 font-semibold" id="clothing-name-1">ã‚«ãƒ¼ãƒ‡</p>
        </div>
        <span class="plus-icon">+</span>
        <div class="flex flex-col items-center">
          <div class="icon-bg"><span role="img" aria-label="t-shirt" id="clothing-icon-2">ğŸ‘•</span></div>
          <p class="text-xs mt-1 font-semibold" id="clothing-name-2">åŠè¢–</p>
        </div>
        <span class="plus-icon">+</span>
        <div class="flex flex-col items-center">
          <div class="icon-bg"><span role="img" aria-label="jeans" id="clothing-icon-3">ğŸ‘–</span></div>
          <p class="text-xs mt-1 font-semibold" id="clothing-name-3">é•·ã‚ºãƒœãƒ³</p>
        </div>
      </div>
      <p class="mt-4 text-sm advice-box" id="clothing-advice">
        æ—¥ä¸­ã¯ã½ã‹ã½ã‹é™½æ°—ã ã‘ã©ã€å¤œã¯è‚Œå¯’ã„ã‹ã‚‚ã€‚ç¾½ç¹”ã‚‹ã‚‚ã®ãŒã‚ã‚‹ã¨å®‰å¿ƒã ã‚ˆï¼
      </p>
    </section>

    <!-- ===== æŒã¡ç‰©ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¨ãƒªã‚¢ ===== -->
    <section class="card transform -rotate-1">
      <h3 class="font-bold text-xl mb-3">ãŠã™ã™ã‚ã®æŒã¡ç‰©</h3>
      <div class="space-y-3" id="items-advice">
        <div class="flex items-center gap-3">
          <span class="text-2xl" role="img" aria-label="umbrella">ğŸŒ‚</span>
          <p class="text-sm font-medium">å¤•æ–¹ã‹ã‚‰é›¨ãŒé™ã‚‹ã‹ã‚‚ï¼ŸæŠ˜ã‚ŠãŸãŸã¿å‚˜ãŒã‚ã‚‹ã¨å®‰å¿ƒï¼</p>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-2xl" role="img" aria-label="sunglasses">ğŸ•¶ï¸</span>
          <p class="text-sm font-medium">æ—¥å·®ã—ãŒå¼·ã„ã‹ã‚‰ã€UVå¯¾ç­–ã¯å¿˜ã‚Œãšã«ã­ã€‚</p>
        </div>
      </div>
    </section>

    <!-- ===== èŠ±ç²‰æƒ…å ±ã‚¨ãƒªã‚¢ ===== -->
    <section class="card transform rotate-1">
      <h3 class="font-bold text-xl mb-3 text-center">ğŸŒ¸ èŠ±ç²‰æƒ…å ±</h3>
      <div class="text-center mb-4">
        <div class="flex justify-center items-center gap-2 mb-2">
          <span class="text-3xl" id="pollen-main-icon">ğŸŒ²</span>
          <div>
            <p class="text-sm text-gray-500" id="pollen-level-label">èŠ±ç²‰ãƒ¬ãƒ™ãƒ«</p>
            <p class="font-bold text-lg" id="pollen-level">ä¸­ç¨‹åº¦</p>
          </div>
        </div>
        <p class="text-sm text-gray-600" id="pollen-advice">
          èŠ±ç²‰ãŒä¸­ç¨‹åº¦ã®æ—¥ã§ã™ã€‚æ•æ„Ÿãªæ–¹ã¯ãƒã‚¹ã‚¯ã®ç€ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
        </p>
      </div>

      <!-- èŠ±ç²‰ã®ç¨®é¡ -->
      <div class="space-y-2 mb-4" id="pollen-types">
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-2">
            <span class="text-xl">ğŸŒ²</span>
            <span class="text-sm">ã‚¹ã‚®èŠ±ç²‰</span>
          </div>
          <span class="text-sm font-semibold text-orange-600">å¤šã„</span>
        </div>
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-2">
            <span class="text-xl">ğŸŒ²</span>
            <span class="text-sm">ãƒ’ãƒã‚­èŠ±ç²‰</span>
          </div>
          <span class="text-sm font-semibold text-yellow-600">ä¸­ç¨‹åº¦</span>
        </div>
      </div>

      <!-- 3æ—¥é–“ã®äºˆå ± -->
      <div class="border-t pt-3">
        <p class="text-sm text-gray-500 mb-2 text-center">3æ—¥é–“ã®äºˆå ±</p>
        <div class="flex justify-around" id="pollen-forecast">
          <div class="text-center">
            <p class="text-xs text-gray-500">ä»Šæ—¥</p>
            <span class="text-lg">ğŸŒ²</span>
            <p class="text-xs font-semibold text-orange-600">å¤šã„</p>
          </div>
          <div class="text-center">
            <p class="text-xs text-gray-500">æ˜æ—¥</p>
            <span class="text-lg">ğŸŒ²</span>
            <p class="text-xs font-semibold text-orange-600">å¤šã„</p>
          </div>
          <div class="text-center">
            <p class="text-xs text-gray-500">æ˜å¾Œæ—¥</p>
            <span class="text-lg">ğŸŒ³</span>
            <p class="text-xs font-semibold text-yellow-600">ä¸­ç¨‹åº¦</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== ä»Šæ—¥ã®å ã„ã‚¨ãƒªã‚¢ ===== -->
    <section class="card transform rotate-1">
      <h3 class="font-bold text-xl mb-3 text-center">ğŸ”® ä»Šæ—¥ã®å ã„</h3>
      
      <!-- æ˜Ÿåº§é¸æŠã‚¿ãƒ– -->
      <div class="mb-4">
        <p class="text-sm text-gray-600 text-center mb-3">ã‚ãªãŸã®æ˜Ÿåº§ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        
        <!-- ã‚¿ãƒ–ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="flex overflow-x-auto scrollbar-hide mb-3">
          <button class="zodiac-tab active" data-zodiac="aries">â™ˆ ãŠã²ã¤ã˜</button>
          <button class="zodiac-tab" data-zodiac="taurus">â™‰ ãŠã†ã—</button>
          <button class="zodiac-tab" data-zodiac="gemini">â™Š ãµãŸã”</button>
          <button class="zodiac-tab" data-zodiac="cancer">â™‹ ã‹ã«</button>
          <button class="zodiac-tab" data-zodiac="leo">â™Œ ã—ã—</button>
          <button class="zodiac-tab" data-zodiac="virgo">â™ ãŠã¨ã‚</button>
          <button class="zodiac-tab" data-zodiac="libra">â™ ã¦ã‚“ã³ã‚“</button>
          <button class="zodiac-tab" data-zodiac="scorpio">â™ ã•ãã‚Š</button>
          <button class="zodiac-tab" data-zodiac="sagittarius">â™ ã„ã¦</button>
          <button class="zodiac-tab" data-zodiac="capricorn">â™‘ ã‚„ã</button>
          <button class="zodiac-tab" data-zodiac="aquarius">â™’ ã¿ãšãŒã‚</button>
          <button class="zodiac-tab" data-zodiac="pisces">â™“ ã†ãŠ</button>
        </div>
        
        <!-- é¸æŠã•ã‚ŒãŸæ˜Ÿåº§ã®è©³ç´°è¡¨ç¤º -->
        <div class="text-center" id="selected-zodiac-info" style="display: none;">
          <div class="bg-gradient-to-r from-pink-100 to-blue-100 rounded-lg p-3">
            <div class="flex items-center justify-center gap-2 mb-1">
              <span class="text-2xl" id="zodiac-symbol">â™ˆ</span>
              <span class="font-bold text-lg" id="zodiac-name">ãŠã²ã¤ã˜åº§</span>
            </div>
            <p class="text-sm text-gray-600" id="zodiac-element">ç«ã®æ˜Ÿåº§</p>
          </div>
        </div>
      </div>
      
      <!-- ç·åˆé‹å‹¢ -->
      <div class="text-center mb-4" id="fortune-content" style="display: none;">
        <div class="flex justify-center items-center gap-2 mb-2">
          <span class="text-4xl" id="fortune-overall-icon">ğŸŒŸ</span>
          <div>
            <p class="text-sm text-gray-500" id="fortune-overall-label">ç·åˆé‹å‹¢</p>
            <p class="font-bold text-lg" id="fortune-overall-level">å¤§å‰</p>
          </div>
        </div>
        <p class="text-sm text-gray-600" id="fortune-advice">
          ä»Šæ—¥ã¯å…¨ã¦ãŒé †èª¿ï¼æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹çµ¶å¥½ã®ãƒãƒ£ãƒ³ã‚¹ã§ã™ã€‚
        </p>
      </div>

      <!-- é‹å‹¢ã‚¹ã‚³ã‚¢ -->
      <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="text-center">
          <div class="flex items-center justify-center gap-1 mb-1">
            <span class="text-xl">ğŸ€</span>
            <span class="text-sm font-semibold">ç·åˆé‹</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-yellow-400 h-2 rounded-full" id="luck-bar" style="width: 85%"></div>
          </div>
          <p class="text-xs text-gray-600 mt-1" id="luck-score">85</p>
        </div>
        <div class="text-center">
          <div class="flex items-center justify-center gap-1 mb-1">
            <span class="text-xl">ğŸ’•</span>
            <span class="text-sm font-semibold">æ‹æ„›é‹</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-pink-400 h-2 rounded-full" id="love-bar" style="width: 90%"></div>
          </div>
          <p class="text-xs text-gray-600 mt-1" id="love-score">90</p>
        </div>
        <div class="text-center">
          <div class="flex items-center justify-center gap-1 mb-1">
            <span class="text-xl">ğŸ’¼</span>
            <span class="text-sm font-semibold">ä»•äº‹é‹</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-blue-400 h-2 rounded-full" id="work-bar" style="width: 72%"></div>
          </div>
          <p class="text-xs text-gray-600 mt-1" id="work-score">72</p>
        </div>
        <div class="text-center">
          <div class="flex items-center justify-center gap-1 mb-1">
            <span class="text-xl">ğŸ¥</span>
            <span class="text-sm font-semibold">å¥åº·é‹</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-green-400 h-2 rounded-full" id="health-bar" style="width: 78%"></div>
          </div>
          <p class="text-xs text-gray-600 mt-1" id="health-score">78</p>
        </div>
      </div>

      <!-- ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ  -->
      <div class="border-t pt-3">
        <div class="flex justify-around text-center">
          <div>
            <p class="text-xs text-gray-500 mb-1">ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼</p>
            <div class="w-8 h-8 rounded-full mx-auto mb-1" id="lucky-color" style="background-color: #ff69b4;"></div>
            <p class="text-xs font-semibold" id="lucky-color-name">ãƒ”ãƒ³ã‚¯</p>
          </div>
          <div>
            <p class="text-xs text-gray-500 mb-1">ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ </p>
            <span class="text-2xl" id="lucky-item-icon">ğŸ€</span>
            <p class="text-xs font-semibold" id="lucky-item-name">å››ã¤è‘‰ã®ã‚¯ãƒ­ãƒ¼ãƒãƒ¼</p>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- ===== é€±é–“äºˆå ±ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
  <div id="weekly-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl max-w-md w-full max-h-[80vh] overflow-y-auto">
        <div class="sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center">
          <h2 id="modal-title" class="text-xl font-bold text-gray-800">é€±é–“äºˆå ±</h2>
          <button id="close-modal" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
        </div>
        <div id="modal-content" class="p-4">
          <!-- é€±é–“ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== ãƒ•ãƒƒã‚¿ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ ===== -->
<footer class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm max-w-sm mx-auto rounded-t-3xl shadow-lg border-t border-blue-100 z-50 h-20">
  <nav class="flex justify-around py-4">
    <a href="#" class="flex flex-col items-center justify-center text-center w-full py-2 active">
      <span class="text-2xl" role="img" aria-label="home">ğŸ </span>
      <span class="text-xs font-bold">ãƒ›ãƒ¼ãƒ </span>
    </a>
    <a href="#" class="flex flex-col items-center justify-center text-gray-400 text-center w-full py-2">
      <span class="text-2xl" role="img" aria-label="calendar">ğŸ—“ï¸</span>
      <span class="text-xs">é€±é–“</span>
    </a>
    <a href="#" class="flex flex-col items-center justify-center text-gray-400 text-center w-full py-2">
      <span class="text-2xl" role="img" aria-label="people">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
      <span class="text-xs">ã¿ã‚“ãª</span>
    </a>
    <a href="#" class="flex flex-col items-center justify-center text-gray-400 text-center w-full py-2">
      <span class="text-2xl" role="img" aria-label="person">ğŸ¥°</span>
      <span class="text-xs">ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
    </a>
  </nav>
</footer>

        <script>
          // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
          let currentWeatherData = null;
          let currentStyle = 'business';
          let userLocation = null;
          let selectedZodiac = null;

  // ç¾åœ¨åœ°ã‚’å–å¾—ã™ã‚‹é–¢æ•°
  function getCurrentLocation() {
    return new Promise((resolve, reject) => {
      if (!navigator.geolocation) {
        reject(new Error('Geolocation is not supported by this browser.'));
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const location = {
            lat: position.coords.latitude,
            lon: position.coords.longitude,
            accuracy: position.coords.accuracy
          };
          userLocation = location;
          resolve(location);
        },
        (error) => {
          console.warn('GPSå–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error.message);
          // GPSãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯æ±äº¬ã®åº§æ¨™ã‚’ä½¿ç”¨
          const fallbackLocation = {
            lat: 35.6762,
            lon: 139.6503,
            accuracy: null
          };
          userLocation = fallbackLocation;
          resolve(fallbackLocation);
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 300000 // 5åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        }
      );
    });
  }

  // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
  async function fetchAndDisplayData() {
    try {
      // ç¾åœ¨ã®æ—¥ä»˜ã‚’è¡¨ç¤º
      const today = new Date();
      const options = {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'short'
      };
      const dateString = today.toLocaleDateString('ja-JP', options);
      document.getElementById('date').textContent = dateString;

      // ç¾åœ¨åœ°ã‚’å–å¾—
      const location = await getCurrentLocation();
      console.log('ç¾åœ¨åœ°:', location);

      // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const weatherResponse = await fetch(`/api/v1/weather?lat=${location.lat}&lon=${location.lon}`);
      const weatherData = await weatherResponse.json();

      if (weatherData.status === 'success') {
        currentWeatherData = weatherData.data;

        // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
        const weatherIcon = document.getElementById('weather-icon');
        weatherIcon.textContent = weatherData.data.current.icon;
        
        // å¤©æ°—ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ï¼ˆã‚ˆã‚Šè©³ç´°ãªåˆ†é¡ï¼‰
        weatherIcon.className = 'text-7xl animate-bounce'; // æºå¸¯æœ€é©åŒ–
        
        // å¤©æ°—æ¡ä»¶ã«å¿œã˜ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨
        const weatherCondition = weatherData.data.current.condition;
        if (weatherCondition === 'clear' || weatherCondition === 'sunny') {
          weatherIcon.classList.add('sunny');
        } else if (weatherCondition === 'clouds' || weatherCondition === 'cloudy') {
          weatherIcon.classList.add('cloudy');
        } else if (weatherCondition === 'rain' || weatherCondition === 'drizzle') {
          weatherIcon.classList.add('rainy');
        } else if (weatherCondition === 'snow') {
          weatherIcon.classList.add('snowy');
        } else if (weatherCondition === 'thunderstorm') {
          weatherIcon.classList.add('stormy');
        }
        
        document.getElementById('temperature').innerHTML = weatherData.data.current.temperature + '<span class="text-2xl align-top text-gray-500">â„ƒ</span>';
        document.getElementById('temp-range').textContent = `${weatherData.data.today.max_temp}â„ƒ / ${weatherData.data.today.min_temp}â„ƒ`;
        document.getElementById('rain-probability').textContent = weatherData.data.today.rain_probability + '%';

        // å ´æ‰€ã®æƒ…å ±ã‚’è¡¨ç¤º
        if (weatherData.data.location) {
          document.getElementById('location').textContent = weatherData.data.location.name;
        }
        
        // æœè£…ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã§ï¼‰
        await fetchClothingData(currentStyle);
        
        // èŠ±ç²‰æƒ…å ±ã‚’å–å¾—
        const pollenResponse = await fetch(`/api/v1/pollen?lat=${location.lat}&lon=${location.lon}`);
        const pollenData = await pollenResponse.json();
        
        if (pollenData.status === 'success') {
          displayPollenInfo(pollenData.data);
        }
        
        // å ã„æƒ…å ±ã‚’å–å¾—
        const fortuneResponse = await fetch(`/api/v1/fortune?lat=${location.lat}&lon=${location.lon}`);
        const fortuneData = await fortuneResponse.json();
        
        if (fortuneData.status === 'success') {
          displayFortuneInfo(fortuneData.data);
        }
        
        // æŒã¡ç‰©ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å–å¾—
        const itemsResponse = await fetch(`/api/v1/items?temperature=${weatherData.data.current.temperature}&weather=${weatherData.data.current.condition}&humidity=${weatherData.data.current.humidity}&wind_speed=${weatherData.data.current.wind_speed}`);
        const itemsData = await itemsResponse.json();
        
        if (itemsData.status === 'success') {
          // æŒã¡ç‰©ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤º
          displayItemsAdvice(itemsData.data);
        }
        
        // ãƒ‡ãƒ¼ã‚¿å–å¾—å¾Œã«ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³ã‚’å†è¨­å®š
        setupStyleButtons();
      }
    } catch (error) {
      console.error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒã¡ç‰©ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤º
      displayDefaultItemsAdvice();
    }
  }

  // æœè£…ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
  async function fetchClothingData(style) {
    if (!currentWeatherData) {
      console.warn('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }
    const temperature = currentWeatherData.current.temperature;
    const weatherCondition = currentWeatherData.current.condition;

    const clothingResponse = await fetch(`/api/v1/clothing?temperature=${temperature}&weather=${weatherCondition}&style=${style}`);
    const clothingData = await clothingResponse.json();

    if (clothingData.status === 'success') {
      displayClothingSuggestion(clothingData.data);
    }
  }

  // æœè£…ææ¡ˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function displayClothingSuggestion(clothingData) {
    const outfit = clothingData.outfit;

    // ã‚¢ã‚¦ã‚¿ãƒ¼ãŒã‚ã‚‹å ´åˆã¨ãªã„å ´åˆã§è¡¨ç¤ºã‚’åˆ†ã‘ã‚‹
    if (outfit.outer) {
      // ã‚¢ã‚¦ã‚¿ãƒ¼ãŒã‚ã‚‹å ´åˆ: ã‚¢ã‚¦ã‚¿ãƒ¼ + ãƒˆãƒƒãƒ—ã‚¹ + ãƒœãƒˆãƒ ã‚¹
      document.getElementById('clothing-icon-1').textContent = getOuterIcon(outfit.outer);
      document.getElementById('clothing-name-1').textContent = outfit.outer;
      document.getElementById('clothing-icon-2').textContent = getTopIcon(outfit.top);
      document.getElementById('clothing-name-2').textContent = outfit.top;
      document.getElementById('clothing-icon-3').textContent = getBottomIcon(outfit.bottom);
      document.getElementById('clothing-name-3').textContent = outfit.bottom;
    } else {
      // ã‚¢ã‚¦ã‚¿ãƒ¼ãŒãªã„å ´åˆ: ãƒˆãƒƒãƒ—ã‚¹ + ãƒœãƒˆãƒ ã‚¹ + é´ or ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼
      document.getElementById('clothing-icon-1').textContent = getTopIcon(outfit.top);
      document.getElementById('clothing-name-1').textContent = outfit.top;
      document.getElementById('clothing-icon-2').textContent = getBottomIcon(outfit.bottom);
      document.getElementById('clothing-name-2').textContent = outfit.bottom;

      if (outfit.shoes) {
        document.getElementById('clothing-icon-3').textContent = getShoesIcon(outfit.shoes);
        document.getElementById('clothing-name-3').textContent = outfit.shoes;
      } else if (outfit.accessories && outfit.accessories.length > 0) {
        document.getElementById('clothing-icon-3').textContent = getAccessoryIcon(outfit.accessories[0]);
        document.getElementById('clothing-name-3').textContent = outfit.accessories[0];
      } else {
        document.getElementById('clothing-icon-3').textContent = 'âœ¨';
        document.getElementById('clothing-name-3').textContent = 'å¿«é©';
      }
    }

    document.getElementById('clothing-advice').textContent = clothingData.advice;
  }

  // æŒã¡ç‰©ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function displayItemsAdvice(itemsData) {
    const itemsAdviceContainer = document.getElementById('items-advice');
    itemsAdviceContainer.innerHTML = ''; // æ—¢å­˜ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢

    // å¿…é ˆã‚¢ã‚¤ãƒ†ãƒ 
    itemsData.essential_items.forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'flex items-center gap-4';
      itemElement.innerHTML = `<span class="text-3xl" role="img">${item.icon}</span><p class="text-sm">${item.reason}</p>`;
      itemsAdviceContainer.appendChild(itemElement);
    });

    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 
    itemsData.optional_items.forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'flex items-center gap-4';
      itemElement.innerHTML = `<span class="text-3xl" role="img">${item.icon}</span><p class="text-sm">${item.reason}</p>`;
      itemsAdviceContainer.appendChild(itemElement);
    });

    if (itemsData.essential_items.length === 0 && itemsData.optional_items.length === 0) {
      const noItemElement = document.createElement('div');
      noItemElement.className = 'flex items-center gap-4';
      noItemElement.innerHTML = `<span class="text-3xl" role="img">ğŸ‘</span><p class="text-sm">ç‰¹ã«å¿…è¦ãªæŒã¡ç‰©ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>`;
      itemsAdviceContainer.appendChild(noItemElement);
    }
  }

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒã¡ç‰©ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•° (APIã‚¨ãƒ©ãƒ¼æ™‚ãªã©)
  function displayDefaultItemsAdvice() {
    const itemsAdviceContainer = document.getElementById('items-advice');
    itemsAdviceContainer.innerHTML = `
      <div class="flex items-center gap-4">
        <span class="text-3xl" role="img">ğŸ¤”</span>
        <p class="text-sm">æŒã¡ç‰©æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ä¸€èˆ¬çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼šæ°´åˆ†è£œçµ¦ã‚’å¿˜ã‚Œãšã«ï¼</p>
      </div>
    `;
  }

  // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªçµµæ–‡å­—ã«æˆ»ã™ï¼‰
  function getOuterIcon(outer) {
    if (outer.includes('ã‚¦ãƒ¼ãƒ«ã‚³ãƒ¼ãƒˆ') || outer.includes('ãƒˆãƒ¬ãƒ³ãƒã‚³ãƒ¼ãƒˆ')) return 'ğŸ§¥';
    if (outer.includes('ãƒ€ã‚¦ãƒ³ã‚¸ãƒ£ã‚±ãƒƒãƒˆ')) return 'ğŸ§¥';
    if (outer.includes('ãƒ–ãƒ¬ã‚¶ãƒ¼')) return 'ğŸ‘”';
    if (outer.includes('ã‚¸ãƒ£ã‚±ãƒƒãƒˆ')) return 'ğŸ§¥';
    if (outer.includes('ã‚¦ã‚¤ãƒ³ãƒ‰ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼')) return 'ğŸ§¥';
    if (outer.includes('ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³')) return 'ğŸ§¶';
    return 'ğŸ§¥';
  }

  function getTopIcon(top) {
    if (top.includes('ãƒãƒ­')) return 'ğŸŒï¸';
    if (top.includes('Tã‚·ãƒ£ãƒ„') || top.includes('åŠè¢–')) return 'ğŸ‘•';
    if (top.includes('é•·è¢–Tã‚·ãƒ£ãƒ„') || top.includes('é•·è¢–')) return 'ğŸ‘•';
    if (top.includes('ãƒ¯ã‚¤ã‚·ãƒ£ãƒ„') || top.includes('ã‚·ãƒ£ãƒ„')) return 'ğŸ‘”';
    if (top.includes('ã‚»ãƒ¼ã‚¿ãƒ¼')) return 'ğŸ§¶';
    if (top.includes('ã‚¿ãƒ³ã‚¯')) return 'ğŸ©³';
    return 'ğŸ‘•';
  }

  function getBottomIcon(bottom) {
    if (bottom.includes('ã‚¹ãƒ©ãƒƒã‚¯ã‚¹') || bottom.includes('ã‚ºãƒœãƒ³')) return 'ğŸ‘–';
    if (bottom.includes('ã‚¸ãƒ¼ãƒ³ã‚º')) return 'ğŸ‘–';
    if (bottom.includes('ãƒãƒ')) return 'ğŸ‘–';
    if (bottom.includes('åŠã‚ºãƒœãƒ³') || bottom.includes('ã‚·ãƒ§ãƒ¼ãƒˆ')) return 'ğŸ©³';
    return 'ğŸ‘–';
  }

  function getShoesIcon(shoes) {
    if (shoes.includes('é©é´')) return 'ğŸ‘';
    if (shoes.includes('ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼')) return 'ğŸ‘Ÿ';
    if (shoes.includes('ãƒ–ãƒ¼ãƒ„')) return 'ğŸ‘¢';
    if (shoes.includes('ã‚µãƒ³ãƒ€ãƒ«')) return 'ğŸ©´';
    if (shoes.includes('é‹å‹•é´')) return 'ğŸ‘Ÿ';
    return 'ğŸ‘Ÿ';
  }

  function getAccessoryIcon(accessory) {
    if (accessory.includes('ãƒã‚¯ã‚¿ã‚¤')) return 'ğŸ‘”';
    if (accessory.includes('ãƒãƒ•ãƒ©ãƒ¼')) return 'ğŸ§£';
    if (accessory.includes('æ‰‹è¢‹')) return 'ğŸ§¤';
    if (accessory.includes('ãƒ‹ãƒƒãƒˆå¸½')) return 'ğŸ§¢';
    return 'âœ¨';
  }

  // èŠ±ç²‰æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function displayPollenInfo(pollenData) {
    // ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ¬ãƒ™ãƒ«
    document.getElementById('pollen-main-icon').textContent = getPollenMainIcon(pollenData.overall_level);
    document.getElementById('pollen-level').textContent = getPollenLevelText(pollenData.overall_level);
    document.getElementById('pollen-advice').textContent = pollenData.advice;

    // èŠ±ç²‰ã®ç¨®é¡
    const pollenTypesContainer = document.getElementById('pollen-types');
    pollenTypesContainer.innerHTML = '';

    pollenData.pollen_types.forEach(pollen => {
      const pollenElement = document.createElement('div');
      pollenElement.className = 'flex justify-between items-center';
      pollenElement.innerHTML = `
        <div class="flex items-center gap-2">
          <span class="text-xl">${pollen.icon}</span>
          <span class="text-sm">${pollen.name}</span>
        </div>
        <span class="text-sm font-semibold ${getPollenLevelColor(pollen.level)}">${getPollenLevelText(pollen.level)}</span>
      `;
      pollenTypesContainer.appendChild(pollenElement);
    });

    // 3æ—¥é–“ã®äºˆå ±
    const forecastContainer = document.getElementById('pollen-forecast');
    forecastContainer.innerHTML = '';

    pollenData.forecast.forEach(day => {
      const forecastElement = document.createElement('div');
      forecastElement.className = 'text-center';
      forecastElement.innerHTML = `
        <p class="text-xs text-gray-500">${day.day}</p>
        <span class="text-lg">${day.icon}</span>
        <p class="text-xs font-semibold ${getPollenLevelColor(day.level)}">${getPollenLevelText(day.level)}</p>
      `;
      forecastContainer.appendChild(forecastElement);
    });
  }

  // èŠ±ç²‰ãƒ¬ãƒ™ãƒ«é–¢é€£ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  function getPollenMainIcon(level) {
    switch(level) {
      case 'very_high': return 'ğŸŒ²';
      case 'high': return 'ğŸŒ²';
      case 'medium': return 'ğŸŒ³';
      case 'low': return 'ğŸŒ¿';
      default: return 'ğŸŒ¸';
    }
  }

  function getPollenLevelText(level) {
    switch(level) {
      case 'very_high': return 'éå¸¸ã«å¤šã„';
      case 'high': return 'å¤šã„';
      case 'medium': return 'ä¸­ç¨‹åº¦';
      case 'low': return 'å°‘ãªã„';
      case 'very_low': return 'éå¸¸ã«å°‘ãªã„';
      default: return 'ä¸æ˜';
    }
  }

  function getPollenLevelColor(level) {
    switch(level) {
      case 'very_high': return 'text-red-600';
      case 'high': return 'text-orange-600';
      case 'medium': return 'text-yellow-600';
      case 'low': return 'text-green-600';
      case 'very_low': return 'text-blue-600';
      default: return 'text-gray-600';
    }
  }

  // å ã„æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function displayFortuneInfo(fortuneData) {
    // ç·åˆé‹å‹¢
    document.getElementById('fortune-overall-icon').textContent = getFortuneOverallIcon(fortuneData.overall_level);
    document.getElementById('fortune-overall-level').textContent = getFortuneOverallText(fortuneData.overall_level);
    document.getElementById('fortune-advice').textContent = fortuneData.advice;

    // é‹å‹¢ã‚¹ã‚³ã‚¢
    document.getElementById('luck-score').textContent = fortuneData.scores.luck;
    document.getElementById('love-score').textContent = fortuneData.scores.love;
    document.getElementById('work-score').textContent = fortuneData.scores.work;
    document.getElementById('health-score').textContent = fortuneData.scores.health;

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
    document.getElementById('luck-bar').style.width = fortuneData.scores.luck + '%';
    document.getElementById('love-bar').style.width = fortuneData.scores.love + '%';
    document.getElementById('work-bar').style.width = fortuneData.scores.work + '%';
    document.getElementById('health-bar').style.width = fortuneData.scores.health + '%';

    // ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ 
    document.getElementById('lucky-color').style.backgroundColor = getColorCode(fortuneData.lucky_color);
    document.getElementById('lucky-color-name').textContent = fortuneData.lucky_color;
    document.getElementById('lucky-item-icon').textContent = getItemIcon(fortuneData.lucky_item);
    document.getElementById('lucky-item-name').textContent = fortuneData.lucky_item;
  }

  // å ã„é–¢é€£ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  function getFortuneOverallIcon(level) {
    switch(level) {
      case 'excellent': return 'ğŸŒŸ';
      case 'good': return 'âœ¨';
      case 'average': return 'ğŸ˜Š';
      case 'poor': return 'ğŸ˜';
      default: return 'ğŸ˜”';
    }
  }

  function getFortuneOverallText(level) {
    switch(level) {
      case 'excellent': return 'å¤§å‰';
      case 'good': return 'å‰';
      case 'average': return 'ä¸­å‰';
      case 'poor': return 'å°å‰';
      default: return 'å‡¶';
    }
  }

  function getColorCode(colorName) {
    const colors = {
      'ãƒ”ãƒ³ã‚¯': '#ff69b4',
      'ã‚´ãƒ¼ãƒ«ãƒ‰': '#ffd700',
      'ãƒ¬ãƒƒãƒ‰': '#ff0000',
      'ã‚ªãƒ¬ãƒ³ã‚¸': '#ffa500',
      'ãƒ­ãƒ¼ã‚º': '#ff69b4',
      'ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼': '#e6e6fa',
      'ã‚³ãƒ¼ãƒ©ãƒ«': '#ff7f50',
      'ãƒ–ãƒ«ãƒ¼': '#0000ff',
      'ãƒã‚¤ãƒ“ãƒ¼': '#000080',
      'ã‚·ãƒ«ãƒãƒ¼': '#c0c0c0',
      'ã‚°ãƒ¬ãƒ¼': '#808080',
      'ã‚°ãƒªãƒ¼ãƒ³': '#008000',
      'ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰': '#50c878',
      'ã‚¿ãƒ¼ã‚³ã‚¤ã‚º': '#40e0d0',
      'ãƒŸãƒ³ãƒˆ': '#98fb98'
    };
    return colors[colorName] || '#ff69b4';
  }

  function getItemIcon(itemName) {
    const icons = {
      'å››ã¤è‘‰ã®ã‚¯ãƒ­ãƒ¼ãƒãƒ¼': 'ğŸ€',
      'æ‹›ãçŒ«': 'ğŸ±',
      'ãŠå®ˆã‚Š': 'ğŸ”®',
      'ã‚¯ãƒªã‚¹ã‚¿ãƒ«': 'ğŸ’',
      'ãƒãƒ¼ãƒˆã®ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼': 'ğŸ’–',
      'ãƒãƒ©ã®èŠ±': 'ğŸŒ¹',
      'ãƒ”ãƒ³ã‚¯ã®çŸ³': 'ğŸ’',
      'ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãªé¦™ã‚Š': 'ğŸŒ¸',
      'ãƒšãƒ³': 'âœï¸',
      'ãƒãƒ¼ãƒˆ': 'ğŸ“',
      'ååˆºå…¥ã‚Œ': 'ğŸ’¼',
      'æ™‚è¨ˆ': 'âŒš',
      'ãƒãƒ¼ãƒ–ãƒ†ã‚£ãƒ¼': 'ğŸµ',
      'ã‚¨ãƒƒã‚»ãƒ³ã‚·ãƒ£ãƒ«ã‚ªã‚¤ãƒ«': 'ğŸ§´',
      'ãƒ¨ã‚¬ãƒãƒƒãƒˆ': 'ğŸ§˜',
      'ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒœãƒˆãƒ«': 'ğŸ’§'
    };
    return icons[itemName] || 'ğŸ€';
  }

  // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥é–¢æ•°
  function refreshData() {
    fetchAndDisplayData();
  }

  // ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã™ã‚‹é–¢æ•°
  function setupStyleButtons() {
    const styleButtons = document.querySelectorAll('.style-btn');
    console.log('ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³æ•°:', styleButtons.length);
    
    if (styleButtons.length === 0) {
      console.log('ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      // å°‘ã—é…å»¶ã—ã¦å†è©¦è¡Œ
      setTimeout(() => {
        setupStyleButtons();
      }, 500);
      return;
    }
    
    styleButtons.forEach((button, index) => {
      console.log(`ãƒœã‚¿ãƒ³${index + 1}:`, button.dataset.style);
      
      // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
      button.removeEventListener('click', handleStyleButtonClick);
      // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
      button.addEventListener('click', handleStyleButtonClick);
      
      // ãƒ†ã‚¹ãƒˆç”¨ï¼šãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã‹ç¢ºèª
      button.style.pointerEvents = 'auto';
      button.style.cursor = 'pointer';
    });
  }
  
  // ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  function handleStyleButtonClick(event) {
    event.preventDefault();
    event.stopPropagation();
    
    console.log('ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ:', this.dataset.style);
    
    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
    const styleButtons = document.querySelectorAll('.style-btn');
    styleButtons.forEach(btn => btn.classList.remove('active'));
    
    // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
    this.classList.add('active');
    
    // é¸æŠã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
    currentStyle = this.dataset.style;
    console.log('ç¾åœ¨ã®ã‚¹ã‚¿ã‚¤ãƒ«:', currentStyle);
    
    // æœè£…ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
    fetchClothingData(currentStyle);
  }
  
          // æ˜Ÿåº§ã‚¿ãƒ–ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
          function setupZodiacTabs() {
            const zodiacTabs = document.querySelectorAll('.zodiac-tab');
            console.log('æ˜Ÿåº§ã‚¿ãƒ–æ•°:', zodiacTabs.length);

            zodiacTabs.forEach((tab) => {
              tab.addEventListener('click', function() {
                // å…¨ã¦ã®ã‚¿ãƒ–ã‹ã‚‰activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                zodiacTabs.forEach(t => t.classList.remove('active'));
                
                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¿ãƒ–ã«activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                this.classList.add('active');
                
                // é¸æŠã•ã‚ŒãŸæ˜Ÿåº§ã‚’ä¿å­˜
                selectedZodiac = this.dataset.zodiac;
                console.log('é¸æŠã•ã‚ŒãŸæ˜Ÿåº§:', selectedZodiac);
                
                // æ˜Ÿåº§è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
                displayZodiacInfo(selectedZodiac);
                
                // å ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
                document.getElementById('fortune-content').style.display = 'block';
                
                // æ˜Ÿåº§å ã„ã‚’å–å¾—
                fetchZodiacFortune(selectedZodiac);
              });
            });
          }

          // æ˜Ÿåº§è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
          function displayZodiacInfo(zodiac) {
            const zodiacData = getZodiacInfo(zodiac);
            
            document.getElementById('zodiac-symbol').textContent = zodiacData.symbol;
            document.getElementById('zodiac-name').textContent = zodiacData.name;
            document.getElementById('zodiac-element').textContent = zodiacData.element;
            
            document.getElementById('selected-zodiac-info').style.display = 'block';
          }

          // æ˜Ÿåº§æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
          function getZodiacInfo(zodiac) {
            const zodiacInfo = {
              aries: { symbol: 'â™ˆ', name: 'ãŠã²ã¤ã˜åº§', element: 'ç«ã®æ˜Ÿåº§' },
              taurus: { symbol: 'â™‰', name: 'ãŠã†ã—åº§', element: 'åœŸã®æ˜Ÿåº§' },
              gemini: { symbol: 'â™Š', name: 'ãµãŸã”åº§', element: 'é¢¨ã®æ˜Ÿåº§' },
              cancer: { symbol: 'â™‹', name: 'ã‹ã«åº§', element: 'æ°´ã®æ˜Ÿåº§' },
              leo: { symbol: 'â™Œ', name: 'ã—ã—åº§', element: 'ç«ã®æ˜Ÿåº§' },
              virgo: { symbol: 'â™', name: 'ãŠã¨ã‚åº§', element: 'åœŸã®æ˜Ÿåº§' },
              libra: { symbol: 'â™', name: 'ã¦ã‚“ã³ã‚“åº§', element: 'é¢¨ã®æ˜Ÿåº§' },
              scorpio: { symbol: 'â™', name: 'ã•ãã‚Šåº§', element: 'æ°´ã®æ˜Ÿåº§' },
              sagittarius: { symbol: 'â™', name: 'ã„ã¦åº§', element: 'ç«ã®æ˜Ÿåº§' },
              capricorn: { symbol: 'â™‘', name: 'ã‚„ãåº§', element: 'åœŸã®æ˜Ÿåº§' },
              aquarius: { symbol: 'â™’', name: 'ã¿ãšãŒã‚åº§', element: 'é¢¨ã®æ˜Ÿåº§' },
              pisces: { symbol: 'â™“', name: 'ã†ãŠåº§', element: 'æ°´ã®æ˜Ÿåº§' }
            };
            
            return zodiacInfo[zodiac] || { symbol: 'â­', name: 'ä¸æ˜', element: '?' };
          }

          // æ˜Ÿåº§å ã„ã‚’å–å¾—ã™ã‚‹é–¢æ•°
          async function fetchZodiacFortune(zodiac) {
            if (!userLocation) {
              console.warn('ä½ç½®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“');
              return;
            }

            try {
              const fortuneResponse = await fetch(`/api/v1/fortune?lat=${userLocation.lat}&lon=${userLocation.lon}&zodiac=${zodiac}`);
              const fortuneData = await fortuneResponse.json();

              if (fortuneData.status === 'success') {
                displayFortuneInfo(fortuneData.data);
              }
            } catch (error) {
              console.error('æ˜Ÿåº§å ã„ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
          }

          // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
          document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ã¾ã—ãŸ');

            // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            fetchAndDisplayData();

            // è¤‡æ•°å›ã«åˆ†ã‘ã¦ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³ã‚’è¨­å®š
            setTimeout(() => {
              console.log('1å›ç›®ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³è¨­å®š');
              setupStyleButtons();
            }, 100);

            setTimeout(() => {
              console.log('2å›ç›®ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³è¨­å®š');
              setupStyleButtons();
            }, 1000);

            setTimeout(() => {
              console.log('3å›ç›®ã®ã‚¹ã‚¿ã‚¤ãƒ«ãƒœã‚¿ãƒ³è¨­å®š');
              setupStyleButtons();
            }, 2000);

            // æ˜Ÿåº§ã‚¿ãƒ–ã‚’è¨­å®š
            setTimeout(() => {
              console.log('æ˜Ÿåº§ã‚¿ãƒ–è¨­å®š');
              setupZodiacTabs();
            }, 500);
          });

          // ===== é€±é–“æ©Ÿèƒ½ =====
          
          // é€±é–“å¤©æ°—äºˆå ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
          async function fetchWeeklyWeather() {
            if (!userLocation) {
              console.warn('ä½ç½®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“');
              return;
            }

            try {
              const response = await fetch(`/api/v1/weather/weekly?lat=${userLocation.lat}&lon=${userLocation.lon}`);
              const data = await response.json();

              if (data.status === 'success') {
                displayWeeklyWeather(data.data);
              }
            } catch (error) {
              console.error('é€±é–“å¤©æ°—äºˆå ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
          }

          // é€±é–“æœè£…ææ¡ˆã‚’å–å¾—ã™ã‚‹é–¢æ•°
          async function fetchWeeklyClothing() {
            if (!userLocation) {
              console.warn('ä½ç½®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“');
              return;
            }

            try {
              const response = await fetch(`/api/v1/clothing/weekly?lat=${userLocation.lat}&lon=${userLocation.lon}&style=${currentStyle}`);
              const data = await response.json();

              if (data.status === 'success') {
                displayWeeklyClothing(data.data);
              }
            } catch (error) {
              console.error('é€±é–“æœè£…ææ¡ˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
          }

          // é€±é–“å¤©æ°—äºˆå ±ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
          function displayWeeklyWeather(weatherData) {
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            
            modalTitle.textContent = 'é€±é–“å¤©æ°—äºˆå ±';
            
            let html = `
              <div class="mb-4">
                <p class="text-sm text-gray-500 text-center">${weatherData.location.name}</p>
              </div>
              <div class="space-y-3">
            `;
            
            weatherData.weekly_forecast.forEach(day => {
              html += `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div class="flex items-center gap-3">
                    <div class="text-center">
                      <p class="text-sm font-medium">${day.day_of_week}</p>
                      <p class="text-xs text-gray-500">${day.date}</p>
                    </div>
                    <span class="text-3xl">${day.icon}</span>
                    <div>
                      <p class="text-sm font-medium">${day.description}</p>
                      <p class="text-xs text-gray-500">é™æ°´ç¢ºç‡ ${day.rain_probability}%</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="text-lg font-bold">${day.max_temp}Â°</p>
                    <p class="text-sm text-gray-500">${day.min_temp}Â°</p>
                  </div>
                </div>
              `;
            });
            
            html += '</div>';
            modalContent.innerHTML = html;
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('weekly-modal').classList.remove('hidden');
          }

          // é€±é–“æœè£…ææ¡ˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
          function displayWeeklyClothing(clothingData) {
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            
            modalTitle.textContent = 'é€±é–“ã‚³ãƒ¼ãƒ‡ã‚£ãƒãƒ¼ãƒˆ';
            
            let html = `
              <div class="mb-4">
                <p class="text-sm text-gray-500 text-center">${clothingData.location.name}</p>
                <p class="text-sm text-gray-600 text-center mt-2">${clothingData.weekly_summary}</p>
              </div>
              <div class="space-y-4">
            `;
            
            clothingData.weekly_outfits.forEach(day => {
              html += `
                <div class="p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div class="text-center">
                      <p class="text-sm font-medium">${day.day_of_week}</p>
                      <p class="text-xs text-gray-500">${day.date}</p>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-2xl">${day.weather.icon}</span>
                      <div class="text-right">
                        <p class="text-sm font-bold">${day.weather.max_temp}Â°</p>
                        <p class="text-xs text-gray-500">${day.weather.min_temp}Â°</p>
                      </div>
                    </div>
                  </div>
                  
                  <div class="flex items-center gap-3 mb-2">
                    <span class="text-2xl">${day.outfit.icon}</span>
                    <div class="flex-1">
                      <p class="text-sm font-medium">${day.outfit.top}</p>
                      <p class="text-xs text-gray-500">${day.outfit.bottom}</p>
                      ${day.outfit.outer ? `<p class="text-xs text-gray-500">${day.outfit.outer}</p>` : ''}
                    </div>
                  </div>
                  
                  <p class="text-xs text-gray-600 mb-2">${day.advice}</p>
                  <p class="text-xs text-blue-600">${day.laundry_suggestion}</p>
                </div>
              `;
            });
            
            html += '</div>';
            modalContent.innerHTML = html;
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('weekly-modal').classList.remove('hidden');
          }

          // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
          document.addEventListener('DOMContentLoaded', function() {
            // é€±é–“å¤©æ°—äºˆå ±ãƒœã‚¿ãƒ³
            document.getElementById('weekly-weather-btn').addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              fetchWeeklyWeather();
            });

            // é€±é–“æœè£…ææ¡ˆãƒœã‚¿ãƒ³
            document.getElementById('weekly-clothing-btn').addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              fetchWeeklyClothing();
            });

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            document.getElementById('close-modal').addEventListener('click', function() {
              document.getElementById('weekly-modal').classList.add('hidden');
            });

            // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‰ã˜ã‚‹
            document.getElementById('weekly-modal').addEventListener('click', function(e) {
              if (e.target === this) {
                this.classList.add('hidden');
              }
            });
          });
</script>